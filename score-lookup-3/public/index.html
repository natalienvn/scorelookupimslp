<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Score Lookup 路 IMSLP</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'></text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    min-height: 100vh;
    background: linear-gradient(168deg, #faf6f0 0%, #f0ebe2 50%, #e8e0d4 100%);
    font-family: 'Source Serif 4', Georgia, serif;
    color: #2c2417;
    -webkit-font-smoothing: antialiased;
  }

  .container { max-width: 680px; margin: 0 auto; padding: 60px 20px; }
  .header { text-align: center; margin-bottom: 52px; }

  .badge {
    display: inline-block; padding: 6px 16px;
    background: #2c2417; color: #f0ebe2;
    font-size: 11px; letter-spacing: 0.15em;
    text-transform: uppercase; border-radius: 4px; margin-bottom: 20px;
  }

  h1 {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 42px; font-weight: 900;
    letter-spacing: -0.02em; line-height: 1.15; margin-bottom: 12px;
  }

  .header p { font-size: 17px; color: #8b7355; max-width: 460px; margin: 0 auto; line-height: 1.55; }

  .divider {
    height: 1px;
    background: linear-gradient(90deg, transparent, #c4b8a5, transparent);
    margin-bottom: 44px;
  }

  .section { margin-bottom: 48px; }

  .section h2 {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 26px; font-weight: 700; margin-bottom: 4px;
  }

  .subtitle { font-size: 15px; color: #8b7355; font-style: italic; margin-bottom: 18px; }
  .input-row { display: flex; gap: 10px; }

  .input-row input {
    flex: 1; padding: 13px 18px;
    font-family: 'Source Serif 4', Georgia, serif; font-size: 16px;
    border: 1.5px solid #d4c9b8; border-radius: 8px;
    background: #fffefa; color: #2c2417; outline: none;
    transition: border-color 0.2s;
  }

  .input-row input:focus { border-color: #8b7355; }
  .input-row input::placeholder { color: #b8a990; }

  .input-row button {
    padding: 13px 28px;
    font-family: 'Source Serif 4', Georgia, serif;
    font-size: 15px; font-weight: 600;
    background: #2c2417; color: #fffefa;
    border: none; border-radius: 8px; cursor: pointer;
    transition: background 0.2s, transform 0.1s;
    letter-spacing: 0.02em; white-space: nowrap;
  }

  .input-row button:hover { background: #3d3226; }
  .input-row button:active { transform: scale(0.97); }
  .input-row button:disabled { background: #d4c9b8; cursor: default; transform: none; }

  .loader { display: none; gap: 6px; padding: 18px 0 6px; }
  .loader.active { display: flex; }
  .loader span { width: 7px; height: 7px; border-radius: 50%; background: #8b7355; animation: pulse 1.2s ease-in-out infinite; }
  .loader span:nth-child(2) { animation-delay: 0.15s; }
  .loader span:nth-child(3) { animation-delay: 0.3s; }

  @keyframes pulse {
    0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
    40% { opacity: 1; transform: scale(1.1); }
  }

  .results { margin-top: 16px; display: none; }
  .results.active { display: block; animation: fadeIn 0.3s ease; }

  .result-card {
    padding: 18px 22px; background: #f7f3ec;
    border-left: 3px solid #8b7355; border-radius: 6px; margin-bottom: 12px;
  }

  .result-title {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 17px; font-weight: 700; margin-bottom: 6px;
  }

  .result-title a {
    color: #2c2417; text-decoration: none;
    border-bottom: 1px solid #c4b8a5; transition: border-color 0.2s;
  }

  .result-title a:hover { border-color: #2c2417; }
  .result-snippet { font-size: 14.5px; line-height: 1.55; color: #6b5d4d; }

  .verdict {
    display: inline-block; padding: 3px 10px; border-radius: 4px;
    font-size: 12px; font-weight: 600; letter-spacing: 0.06em;
    text-transform: uppercase; margin-bottom: 8px;
  }

  .v-yes { background: #d4edda; color: #245830; }
  .v-no { background: #f8d7da; color: #78222b; }
  .v-maybe { background: #fff3cd; color: #7a6420; }
  .v-open { background: #d1ecf1; color: #0c5460; }
  .v-unknown { background: #e8e0d4; color: #5a4d3e; }

  .result-detail { font-size: 14px; line-height: 1.6; color: #5a4d3e; margin-top: 4px; }

  .no-results {
    padding: 18px 22px; background: #f7f3ec;
    border-left: 3px solid #c4b8a5; border-radius: 6px;
    font-size: 15px; line-height: 1.6; color: #6b5d4d;
  }

  .error-msg {
    padding: 14px 18px; background: #fdf0ef;
    border-left: 3px solid #cc4455; border-radius: 6px;
    font-size: 15px; color: #8b3030;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .footer { margin-top: 24px; text-align: center; font-size: 13px; color: #b8a990; line-height: 1.6; }
  .footer a { color: #8b7355; }

  @media (max-width: 500px) {
    h1 { font-size: 30px; }
    .container { padding: 40px 16px; }
    .input-row { flex-direction: column; }
    .input-row button { width: 100%; }
  }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="badge">IMSLP 路 Petrucci Music Library</div>
    <h1>Score Lookup</h1>
    <p>Check the copyright status of a musical work and whether it's available on IMSLP.</p>
  </div>

  <div class="divider"></div>

  <div class="section">
    <h2>Is this public domain?</h2>
    <p class="subtitle">Enter a composer, work, or edition to check its copyright status</p>
    <div class="input-row">
      <input type="text" id="pd-input" placeholder='e.g. "Debussy Clair de Lune" or "Ravel Bolero"'>
      <button id="pd-btn">Check</button>
    </div>
    <div class="loader" id="pd-loader"><span></span><span></span><span></span></div>
    <div class="results" id="pd-results"></div>
  </div>

  <div class="divider"></div>

  <div class="section">
    <h2>Is this on IMSLP?</h2>
    <p class="subtitle">Search for scores, parts, and recordings on the Petrucci Music Library</p>
    <div class="input-row">
      <input type="text" id="imslp-input" placeholder='e.g. "Brahms Symphony No. 4" or "Ysa每e Solo Sonatas"'>
      <button id="imslp-btn">Check</button>
    </div>
    <div class="loader" id="imslp-loader"><span></span><span></span><span></span></div>
    <div class="results" id="imslp-results"></div>
  </div>

  <div class="footer">
    Searches <a href="https://imslp.org" target="_blank">IMSLP.org</a> directly 路 Results are informational, not legal advice
  </div>
</div>

<script>
function esc(str) {
  var d = document.createElement("div");
  d.textContent = str;
  return d.innerHTML;
}

function vc(verdict) {
  var v = verdict.toUpperCase();
  if (v === "YES" || v === "LIKELY YES") return "v-yes";
  if (v === "NO" || v === "LIKELY NO") return "v-no";
  if (v === "PARTIALLY" || v.includes("DEPENDS")) return "v-maybe";
  if (v.includes("OPEN") || v.includes("LICENSE")) return "v-open";
  return "v-unknown";
}

function checkCopyright() {
  var input = document.getElementById("pd-input");
  var btn = document.getElementById("pd-btn");
  var loader = document.getElementById("pd-loader");
  var results = document.getElementById("pd-results");
  var q = input.value.trim();
  if (!q) return;

  btn.disabled = true;
  btn.textContent = "Checking\u2026";
  loader.classList.add("active");
  results.classList.remove("active");
  results.innerHTML = "";

  fetch("/api/copyright?q=" + encodeURIComponent(q))
    .then(function(r) { return r.json(); })
    .then(function(data) {
      if (data.error) {
        results.innerHTML = '<div class="error-msg">' + esc(data.error) + '</div>';
      } else if (data.results && data.results.length > 0) {
        var html = "";
        data.results.forEach(function(r) {
          html += '<div class="result-card">';
          html += '<div class="verdict ' + vc(r.verdict) + '">' + esc(r.verdict) + '</div>';
          html += '<div class="result-title"><a href="' + esc(r.link) + '" target="_blank">' + esc(r.title) + '</a></div>';
          r.details.forEach(function(d) {
            html += '<div class="result-detail">' + esc(d) + '</div>';
          });
          html += '</div>';
        });
        results.innerHTML = html;
      } else {
        results.innerHTML = '<div class="no-results">' + esc(data.message || 'No results found. Try "Composer + Work Title".') + '</div>';
      }
      results.classList.add("active");
    })
    .catch(function() {
      results.innerHTML = '<div class="error-msg">Something went wrong. Please try again.</div>';
      results.classList.add("active");
    })
    .finally(function() {
      btn.disabled = false;
      btn.textContent = "Check";
      loader.classList.remove("active");
    });
}

function searchIMSLP() {
  var input = document.getElementById("imslp-input");
  var btn = document.getElementById("imslp-btn");
  var loader = document.getElementById("imslp-loader");
  var results = document.getElementById("imslp-results");
  var q = input.value.trim();
  if (!q) return;

  btn.disabled = true;
  btn.textContent = "Checking\u2026";
  loader.classList.add("active");
  results.classList.remove("active");
  results.innerHTML = "";

  fetch("/api/search?q=" + encodeURIComponent(q))
    .then(function(r) { return r.json(); })
    .then(function(data) {
      if (data.error) {
        results.innerHTML = '<div class="error-msg">' + esc(data.error) + '</div>';
      } else if (data.results && data.results.length > 0) {
        var html = '<div class="result-card" style="border-left-color:#245830;background:#f2f7f3;">';
        html += '<div class="verdict v-yes">YES \u2014 ' + data.results.length + ' result' + (data.results.length > 1 ? 's' : '') + ' found</div></div>';
        data.results.forEach(function(r) {
          html += '<div class="result-card">';
          html += '<div class="result-title"><a href="' + esc(r.link) + '" target="_blank">' + esc(r.title) + '</a></div>';
          if (r.snippet) html += '<div class="result-snippet">' + esc(r.snippet) + '</div>';
          html += '</div>';
        });
        results.innerHTML = html;
      } else {
        results.innerHTML = '<div class="result-card" style="border-left-color:#cc4455;">' +
          '<div class="verdict v-no">NOT FOUND</div>' +
          '<div class="result-detail">No matching works found on IMSLP. Try different terms. ' +
          '<a href="https://imslp.org/wiki/Special:Search?search=' + encodeURIComponent(q) +
          '" target="_blank" style="color:#8b7355;">Search IMSLP directly \u2192</a></div></div>';
      }
      results.classList.add("active");
    })
    .catch(function() {
      results.innerHTML = '<div class="error-msg">Something went wrong. Please try again.</div>';
      results.classList.add("active");
    })
    .finally(function() {
      btn.disabled = false;
      btn.textContent = "Check";
      loader.classList.remove("active");
    });
}

document.getElementById("pd-btn").addEventListener("click", checkCopyright);
document.getElementById("imslp-btn").addEventListener("click", searchIMSLP);
document.getElementById("pd-input").addEventListener("keydown", function(e) { if (e.key === "Enter") checkCopyright(); });
document.getElementById("imslp-input").addEventListener("keydown", function(e) { if (e.key === "Enter") searchIMSLP(); });
</script>

</body>
</html>
